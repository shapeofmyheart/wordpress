/*!
* Cx-udy-dianka
* Used to complete a series of work in the user center.
* 2017-2-23 
* http://www.chenxingweb.com/
* V:0.1
*/
function tinAlert($msg){var $content='<div class="tinalert"><div class="alert_title"><h4>来自网页的提醒</h4></div><div class="alert_content"><p>'+$msg+'</p></div><div class="alert_cancel"><button class="cancel-to-back btn btn-danger">确定</button></div><span class="alert_close"><i class="fa fa-close"></i></span></div>';$('body').append($content);$(".alert_close, .alert_cancel .btn").bind('click',function(){$('.tinalert').fadeOut().remove()});$('.tinalert').fadeIn()}function chenxing_do_post(formid,posturl,postdata,contentid){$(formid).find('[type="submit"]').addClass('disabled').prepend(tinRefreshIcon);$.ajax({type:'POST',url:posturl,data:postdata,success:function(response){$(contentid).html($(response).find(contentid).html())},error:function(){chenxing_do_post(formid,posturl,postdata,contentid)}})}function cx_post_down(val){switch(val){case'zhijie':$('.col_block').hide(300);break;case'jifen':$('.col_block').show(300);break}}function tinSetCookie(c_name,value,expire,path){var exdate=new Date();exdate.setTime(exdate.getTime()+expire*1000);document.cookie=c_name+"="+escape(value)+((expire==null)?"":";expires="+exdate.toGMTString())+((path==null)?"":";path="+path)}function tinGetCookie(c_name){if(document.cookie.length>0){c_start=document.cookie.indexOf(c_name+"=");if(c_start!=-1){c_start=c_start+c_name.length+1;c_end=document.cookie.indexOf(";",c_start);if(c_end==-1)c_end=document.cookie.length;return unescape(document.cookie.substring(c_start,c_end))}}return""}function set_chenxing_nonce(){$.ajax({type:'POST',url:chenxing.ajax_url,data:{'action':'chenxing_create_nonce'},success:function(response){tinSetCookie('chenxing_check_nonce',$.trim(response),3600,chenxing.home_url)},error:function(){set_chenxing_nonce()}})}$(function(){var tinRefreshIcon='<i class="fa fa-spinner fa-spin" style="margin-right:4px;"></i>';var wpnonce=tinGetCookie('chenxing_check_nonce');if(wpnonce==null||wpnonce=="")set_chenxing_nonce();$(".tooltip-trigger").each(function(b){if(this.title){var c=this.title;var a=5;$(this).mouseover(function(d){this.title="";$(this).append('<div class="tooltip top" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner">'+c+'</div></div>');$(".tooltip").css({left:(($(this).width()-$('.tooltip').width())/2)+"px",bottom:($(this).height()+a)+"px"}).addClass('in').fadeIn(250)}).mouseout(function(){this.title=c;$(".tooltip").remove()})}});$(".alert_close, .alert_cancel .btn").click(function(){$('.tinalert').fadeOut()});$('#pmform').submit(function(){var formid='#pmform';var p=$(formid);chenxing_do_post(formid,location.href,{'pmNonce':p.find('[name="pmNonce"]').val(),'pm':p.find('[name="pm"]').val()},'.user-right');return false});$('#creditform').submit(function(){var formid='#creditform';var p=$(formid);var obj;var checked;obj=document.getElementsByName('creditChange');if(obj){for(var i=0;i<obj.length;i++){if(obj[i].checked){checked=obj[i].getAttribute('value')}else{checked='add'}}}else{checked='add'}chenxing_do_post(formid,location.href,{'creditNonce':p.find('[name="creditNonce"]').val(),'creditChange':checked,'creditNum':p.find('[name="creditNum"]').val(),'creditDesc':p.find('[name="creditDesc"]').val()},'.user-right');return false});$('#chen_dianka').on('click',function(){var $this=$(this);$this.html('<i class="fa fa-spinner fa-spin" style="color:#f00"></i>');if($this.hasClass('disabled'))return false;$this.addClass('disabled');var num=$("input[name='promote_num']").val(),count=$("input[name='count_value']").val(),date=$("input[name='dexpire_date']").val();$.ajax({type:'POST',dataType:'html',url:chenxing.ajax_url,async:false,data:{'action':'pl_chonzhika','num':num,'count':count,'date':date,},success:function(b){$('.dianka_list').html(b);$this.html('已生成')}});return false});$('#promoteform').submit(function(){var formid='#promoteform';var p=$(formid);var obj;var checked;obj=document.getElementsByName('promote_type');if(obj){for(var i=0;i<obj.length;i++){if(obj[i].checked){checked=obj[i].getAttribute('value')}else{checked='once'}}}else{checked='once'}chenxing_do_post(formid,location.href,{'promoteNonce':p.find('[name="promoteNonce"]').val(),'promote_code':p.find('[name="promote_code"]').val(),'promote_type':checked,'discount_value':p.find('[name="discount_value"]').val(),'expire_date':p.find('[name="expire_date"]').val()},'.user-right');return false});$(document.body).on('click','.delete_promotecode',function(){$(this).html('<i class="fa fa-spinner fa-spin" style="color:#f00"></i>');var p=$(this).parent('tr').children('input[name=promote_id]');var promote_id=p.val();var dpromoteNonce=$('.promote-table input[name=dpromoteNonce]').val();$.ajax({type:'POST',url:location.href,data:{'promote_id':promote_id,'dpromoteNonce':dpromoteNonce},success:function(response){$('.user-right').html($(response).find('.user-right').html())},error:function(){tinAlert('删除失败,请重新再试')}});return false});$('#joinvip-submit').click(function create_vip_order(){$('#joinvip-submit').addClass('disabled').prepend(tinRefreshIcon);var obj;var product_id=-1;obj=document.getElementsByName('product_id');if(obj){for(var i=0;i<obj.length;i++){if(obj[i].checked){product_id=obj[i].getAttribute('value')}}}$.ajax({type:'POST',dataType:'json',async:false,url:chenxing.ajax_url,data:{'action':'create_vip_order','product_id':product_id},success:function(response){$('#joinvip-submit').removeClass('disabled');$('#joinvip-submit i').remove();if(response.success==1){$('input#order_id').val(response.order_id);$("form#joinvip").attr('onsubmit','').submit()}else{tinAlert(response.msg)}},});return false});$(document.body).on('click','.dianka_chon',function(){var obj=$(this);obj.text('充值中..');var product_id=-4,credit_mima=$('input[name=credit_mima]').val(),credit_kahao=$('input[name=credit_kahao]').val();if(!credit_mima){tinAlert('请输入密码后提交！');return false}$.ajax({type:'POST',dataType:'json',async:false,url:chenxing.ajax_url,data:{'action':'create_credit_chongzhi','product_id':product_id,'credit_mima':credit_mima,'credit_kahao':credit_kahao},success:function(b){if(b.success==1){var sing=$('.msg');sing.children('h3').text('您的充值已完成，感谢您的支持！');sing.children('p').text(b.msg);obj.text('关 闭').addClass('gb_cloe').removeClass('dianka_chon')}else{tinAlert(b.msg)}},});return false});$('#creditrechargesubmit').on('click',function(){var obj=$('#creditrechargeform');if(obj.find('[type="submit"]').hasClass('disabled'))return false;obj.find('[type="submit"]').addClass('disabled').prepend(tinRefreshIcon);var creditrechargeNum=$('input[name=creditrechargeNum]').val();$.ajax({type:'POST',dataType:'json',async:false,url:chenxing.ajax_url,data:{'action':'create_credit_recharge_order','creditrechargeNum':creditrechargeNum},success:function(b){if(b.success==1){html='';html+='<input class="form-control" type="text" name="credit_mima" value="" placeholder="输入充值卡密码" required style="width: 80%;margin: 0 auto;margin-top: 30px;">';html+='<input type="hidden" name="credit_kahao" value="'+b.order_id+'">';chen_tixing('<i class="fa fa-check-square-o"></i> 充值卡反馈',b.msg,html,'立即充值',' gb_cloe',' dianka_chon')}else{tinAlert(b.msg)}},});return false});$('#chen_dianka_cha').on('click',function(){var obj=$(this);if(obj.hasClass('disabled'))return false;obj.addClass('disabled').text('查询中');var code=$('#promote_num_cha').val(),user_id=$('input[name=count_value_id]').val();if(!user_id){tinAlert('查询号码不能为空');obj.removeClass('disabled').text('查询');return false}$.ajax({type:'POST',dataType:'json',async:false,url:chenxing.ajax_url,data:{'action':'chen_dianka_zz','kahao':code,'id':user_id},success:function(b){obj.removeClass('disabled').text('查询');if(b.success==1){if(b.code.sunc==1){html='面值：'+b.code.pay+'(积分) 状态：未使用<br>过期时间：'+b.code.time}else{html='面值：'+b.code.pay+'(积分) 状态：已使用<br>使用时间：'+b.code.date+'<br> 使用者：'+b.code.name+'(ID '+b.code.id+')'}chen_tixing('<i class="fa fa-check-square-o"></i> 充值卡信息',b.msg,html,'我已了解',' gb_cloe',' gb_cloe')}else if(b.success==2){html='';html+='<table class="table table-bordered promote-table">';html+='<thead><tr class="active"><th>卡号</th><th>面值</th><th>充值时间</th></tr></thead><tbody>';html+=b.code.html;html+='</tbody></table>';$('.dianka_list').html(html);obj.removeClass('disabled').text('查询')}else{tinAlert(b.msg)}},});return false});$('#chen_log_cha').on('click',function(){var obj=$(this);if(obj.hasClass('disabled'))return false;obj.addClass('disabled').text('查询中');var code=$('#down_type').val(),nonce=$('input[name=downNonce]').val(),user_id=$('input[name=down_value_id]').val();if(!user_id){tinAlert('查询号码不能为空');obj.removeClass('disabled').text('查询');return false}$.ajax({type:'POST',dataType:'json',async:false,url:chenxing.ajax_url,data:{'action':'down_log_query','down-nonce':nonce,'down_type':code,'pid':user_id},success:function(b){obj.removeClass('disabled').text('查询');if(b.success==1){html='';html+='<table class="table table-bordered promote-table">';html+='<thead><tr class="active"><th>资源名称</th><th scope="col">资源ID</th><th>下载用户</th><th>用户ID</th><th>下载时间</th><th>下载IP</th></tr></thead><tbody>';html+=b.msg;html+='</tbody></table>';$('.dianka_list').html(html);obj.removeClass('disabled').text('查询')}else{tinAlert(b.msg)}},});return false});$("input[name=_cx_post_down]").on('click',function(){cx_post_down($(this).val())});$("input[name=down_rad]").on('click',function(){if($(this).val()=='bq'){$('.col_vip').show(300);var $url=$('#down_url').val(),$mima=$('#down_mima').val();if($url){$('#down_vip').val($url+'|'+$mima)}else{$('#down_vip').val('下载地址URL 例：http://123 | 下载密码 例：1234')}}else if($(this).val()=='bg'){$('.col_vip').hide(300);$('#down_vip').val('')}});$('a#daily_sign').bind('click',function(){var $this=$(this);$.ajax({type:'POST',dataType:'json',async:false,url:chenxing.ajax_url,data:{'action':'daily_sign'},success:function(response){if(response.success==1){$this.attr({'id':'daily_signed','title':'今日已签到'}).text('已签到');if($this.prev('a').length>0){var credit=Number($.trim($this.prev('a').text()))+Number(response.credits);$this.prev('a').text(' '+credit)}else{tinAlert(response.msg)}}else{tinAlert(response.msg)}},})})});

// Continue pay
$('.continue-pay').on('click',function(){
	var $this = $(this);
	var id = $this.attr('data-id'),
		form = $('#continue-pay'),
		oid_obj = form.children('input#order_id');
	$.ajax({
		type: 'POST',
		dataType: 'json',
		url:chenxing.ajax_url,
		data:{
			'action' : 'continue_order',
			'id' : id
		},
		success:function(response){
			if(response.success==1&&response.order.order_currency=='cash'){
				oid_obj.val(response.order.order_id);				
				form.submit();
			}else{
				alert(response.msg);
				return false;
			}
		}
	});
});