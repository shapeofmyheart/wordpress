/*!
* Cx-udy-dianka
* Used to complete a series of work in the user center.
* 2017-2-23 
* http://www.chenxingweb.com/
* V:0.1
*/
jQuery(document).ready(function($){var html_to=$('.cx_file_preview').html();if(html_to!=''){$('.chenxing_upload_button').css({"position":"absolute","bottom":"20px","height":"40px","line-height":"20px","right":"20px",}).text('修改封面图片');$('.cx_file_preview').show()}var upload_frame,gallery_frame,value_id;$('.chenxing_upload_button').on('click',function(event){event.preventDefault();value_id=$(this).attr('id');if(upload_frame){upload_frame.open();return}upload_frame=wp.media({title:'设置封面图像',button:{text:'添加'},multiple:false});upload_frame.on('select',function(){var attachment=upload_frame.state().get('selection').first().toJSON();$('input[name='+value_id+']').val(attachment.id).trigger('change');$select=$('.cx_file_preview');$value=attachment.url;if($value){var index1=$value.lastIndexOf('.');var index2=$value.length;var file_type=$value.substring(index1,index2);if($.inArray(file_type,['.png','.jpg','.gif','.bmp'])!='-1'){img_src=$value;$file_view='<img src ="'+img_src+'" />';$($select).html('').append($file_view).show();$('.chenxing_upload_button').css({"position":"absolute","bottom":"20px","height":"40px","line-height":"20px","right":"20px",}).text('修改封面图片');if(attachment.height>attachment.width){$($select).children('img').css("float","left")}}}});upload_frame.open()});function post_tag($name){var cid=$('.tag_mun');var cid_val=cid.html();var cid_leng=cid.children('input').length;suncto=true;if(cid_val){$(".tag_mun label").each(function(){var book=$(this).text();if(book==$name){suncto=false}})}if(suncto){if(cid_leng<5){tag_num=cid_leng+1;html='<input type="checkbox" class="ashuwp_field_radio" value="'+$name+'" id="_id_checkbox_'+tag_num+'" checked name="_post_tag[]"><label for="_id_checkbox_'+tag_num+'">'+$name+'</label>';cid.html(cid_val+html)}else{alert('最多添加5个标签！')}}else{alert('您已经添加过这个标签了！')}};$('.post_rm_tag li').on('click',function(){var txt=$(this).children('a').text();if(txt){post_tag(txt)}return false});$('.tag_mun').on('click','label',function(){var thit=$(this).attr('for');var id='#'+thit;$(''+id).remove();$(this).remove();return false});var $tag=$('#post_tag_tianjia');$('#post_tag__input').keydown(function(e){if(e.keyCode==13){$tag.click();return false}});$tag.on('click',function(){var txt=$('#post_tag__input').val();if(txt){post_tag(txt)}$('#post_tag__input').val('');return false});$('.db_none_chen').on('click',function(){if($(".db_form_chen").css("display")=="none"){$(".db_form_chen").slideDown();$(this).html('<i class="fa fa-angle-up"></i><br>收起资源设置框')}else{$(".db_form_chen").slideUp();$(this).html('点击设置附件资源<br><i class="fa fa-angle-down"></i>')}});$('#chen_tougao_submit').on('click',function(){var $this=$(this);$this.html('正在提交 ...');if($this.hasClass('disabled'))return false;$this.addClass('disabled');var e=tinymce.editors["post_content"];var content=(e&&!e.isHidden())?e.getContent():$('#post_content').val(),title = $('#chen_post_title').val(),post_cat=$('#chen_post_cat').val(),tuijian=$("input[name='_chen_tuijian']:checked").val(),down_name=$('#down_name').val()+'|'+$('#down_meta').val(),down_url=$('#down_url').val()+'|'+$('#down_mima').val()+'|'+$('#down_pay').val(),post_text = $('form').serialize(),_wpnonce=$('#_wpnonce').val(),post_tag=$("input[name='_post_tag[]']:checked").map(function(index,elem){return $(elem).val()}).get().join(',');if(!title||!content){alert('标题和内容不可为空！');$this.removeClass('disabled');$this.html('提交投稿');return false}else if(content.length<140){alert('您投稿的内容太短，请重新编辑后再提交！');$this.removeClass('disabled');$this.html('提交投稿');return false}$.ajax({type:'POST',dataType:'json',url:chenxing.ajax_url,async:false,data:{'action':'chenxing_tougao','content':content,'post_cat':post_cat,'tuijian':tuijian,'down_name':down_name,'down_url':down_url,'post_meta':post_text,'_wpnonce':_wpnonce,'post_tag':post_tag,},success:function(b){if(b.success!=1){chen_tixing('<i class="fa fa-plus-square"></i> 结果反馈','您的文章提交失败','您可以重新编辑之后再次提交','返 回',' fk_cloe',' fk_cloe')}else{chen_tixing('<i class="fa fa-check-square-o"></i> 结果反馈',b.post_id.title,b.post_id.cont,b.post_id.bottom,' gb_cloe',' gb_cloe')}}});return false})});function auto_post(){if(chenxing.auto_page == 'off'){var format = $('#post-formats').val();if((format=='0' && chenxing.page_nz !='no') || format=='image'){$('#cx_auto_page_num').val(chenxing.page_img);}else{$('#cx_auto_page_num').val(0);}}}$(function(){auto_post();$("#post-formats").change(function(){auto_post();});});